# Short-Form Video Asset Generator - Product Plan

## Overview

A web application that enables creators to generate short-form video content by providing a reference video (for style/structure) and optional steering prompts (text/images). The system analyzes the reference, expands user prompts, and routes to the appropriate Alibaba Wan 2.6 model to generate a new ~15 second video.

---

## Wan 2.6 Model Usage Strategy

### Available Models & When to Use Each

| Model | Input | Use Case in Our App |
|-------|-------|---------------------|
| **wan2.6-t2v** | Text prompt only | User provides ONLY text description, no reference video or images |
| **wan2.6-i2v** | First-frame image + text prompt | User provides a product image to animate (Option A flow) |
| **wan2.6-i2v-flash** | First-frame image + text prompt | Same as i2v but faster/cheaper - use for previews or when speed matters |
| **wan2.6-r2v** | Reference video/image + text prompt | User provides a reference video to remix/restyle (Option C flow) - **PRIMARY MODEL** |

### Model Routing Logic

```
IF user provides reference video:
    → Use wan2.6-r2v (reference-to-video)
    → Extract character/style consistency from reference
    → Apply steering prompts for modifications

ELSE IF user provides image(s) only:
    → Use wan2.6-i2v or wan2.6-i2v-flash (image-to-video)
    → Use image as first frame
    → Generate motion based on expanded prompt

ELSE IF user provides text only:
    → Use wan2.6-t2v (text-to-video)
    → Generate entirely from text description
```

### Key API Details

- **Async workflow**: Create task → Poll for result (1-5 minutes typical)
- **Max duration**: 2-15 seconds (we'll default to 10-15s)
- **Resolutions**: 720P or 1080P (default to 720P for speed)
- **Audio**: Auto-generated by default (wan2.5+ models)
- **Prompt expansion**: Built-in `prompt_extend: true` improves short prompts significantly
- **Multi-shot narrative**: Supported via `shot_type: "multi"` for trailer-style content

### API Endpoints (Virginia region)

```
POST https://dashscope-us.aliyuncs.com/api/v1/services/aigc/video-generation/video-synthesis
GET  https://dashscope-us.aliyuncs.com/api/v1/tasks/{task_id}
```

---

## Neo4j Consideration

**Verdict: Skip for MVP**

Neo4j would be valuable for:
- Tracking style/aesthetic relationships between videos
- Building a "style graph" connecting reference videos → generated outputs → user preferences
- Recommendation engine for "videos like this"

However, since we're skipping persistence for MVP, Neo4j adds complexity without immediate value. **Revisit if persistence is added.**

---

## Technical Architecture

### Stack

- **Frontend**: Next.js 14+ (App Router) + React + Shadcn/ui + Tailwind CSS
- **Backend**: Next.js API Routes (sufficient for MVP - no need for separate Express server)
- **Video Processing**: Alibaba Wan API (async polling)
- **State Management**: React state + URL params (no persistence)
- **File Handling**: Browser File API for uploads, temporary URLs for generated videos

### Why Next.js API Routes Are Sufficient

The Wan API handles all heavy lifting asynchronously. Our server only needs to:
1. Proxy requests to Wan API (add auth headers)
2. Poll for task completion
3. Return video URL

No long-running processes on our server = no need for Redis/Bull queues.

---

## User Flow & UI Components

### Core Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                        LANDING PAGE                              │
│  "Transform any video into your creative vision"                 │
│  [Get Started] button                                            │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      INPUT INTERFACE                             │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │  Reference Source (at least one required)                   ││
│  │  ○ Paste URL (YouTube, TikTok, Instagram)                   ││
│  │  ○ Upload Video File                                        ││
│  │  ○ Upload Image(s)                                          ││
│  │  [Drop zone / URL input field]                              ││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                  │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │  Steering Prompt (optional if reference provided)           ││
│  │  [Large text area]                                          ││
│  │  "Edit this video to be focused on [product name]"          ││
│  │  "Make it sepia-toned and vintage"                          ││
│  │                                                             ││
│  │  + Add reference images [upload button]                     ││
│  │  [Thumbnail previews of attached images]                    ││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                  │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │  Settings (collapsible)                                     ││
│  │  Duration: [5s] [10s] [15s]                                 ││
│  │  Resolution: [720P] [1080P]                                 ││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                  │
│  [Generate Video] button                                         │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    GENERATION SCREEN                             │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │                                                             ││
│  │              [Animated progress indicator]                  ││
│  │                                                             ││
│  │         "Analyzing your reference video..."                 ││
│  │         "Crafting your creative prompt..."                  ││
│  │         "Generating video frames..."                        ││
│  │         "Adding audio and finalizing..."                    ││
│  │                                                             ││
│  │         [Progress bar: 45%]                                 ││
│  │         Estimated time: ~3 minutes                          ││
│  │                                                             ││
│  └─────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      RESULT SCREEN                               │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │                                                             ││
│  │              [Video Player - Generated Video]               ││
│  │                                                             ││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                  │
│  [Download Video]  [Generate Another]  [Share Link]              │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### Progress Messages Array (Timed Display)

```typescript
const progressMessages = [
  { message: "Uploading your content...", duration: 3000 },
  { message: "Analyzing reference video style...", duration: 8000 },
  { message: "Extracting visual elements...", duration: 10000 },
  { message: "Crafting your creative prompt...", duration: 8000 },
  { message: "Generating video frames...", duration: 45000 },
  { message: "Composing audio track...", duration: 15000 },
  { message: "Rendering final video...", duration: 20000 },
  { message: "Almost there...", duration: 60000 }, // fallback for long waits
];
```

---

## Implementation Breakdown

### Phase 1: Core Infrastructure (Do First)

1. **Next.js project setup**
   - Initialize with App Router, TypeScript, Tailwind, Shadcn
   - Environment variables for Wan API key
   - Basic layout and navigation

2. **Wan API integration**
   - `/api/generate` - Create video generation task
   - `/api/status/[taskId]` - Poll task status
   - Error handling for API failures

3. **Basic UI shell**
   - Input page with text prompt field
   - Generation page with progress indicator
   - Result page with video player

### Phase 2: Input Handling

4. **URL input for reference videos**
   - Paste YouTube/TikTok/Instagram URLs
   - Note: For MVP, we may need to instruct users to provide direct video file URLs or download videos first (platform APIs for video download are complex)
   - Alternative: Accept any direct video URL

5. **File upload**
   - Drag-and-drop zone for video/image files
   - File type validation (mp4, webm, jpg, png, etc.)
   - Preview thumbnails
   - Convert to base64 or upload to temporary storage for API

6. **Steering prompt interface**
   - Large text area for descriptions
   - Ability to attach reference images
   - Character/length validation

### Phase 3: Prompt Engineering Layer

7. **Prompt expansion service**
   - Take user's simple prompt + reference context
   - Expand into detailed Wan-compatible prompt
   - Include style descriptors, camera angles, lighting, etc.
   - Can use an LLM (Qwen or similar) to expand prompts before sending to Wan

### Phase 4: Polish

8. **Progress UI**
   - Animated loading states
   - Timed message rotation
   - Estimated time remaining

9. **Result handling**
   - Video player with controls
   - Download functionality
   - "Generate another" flow

---

## File Structure

```
short-form-asset-gen/
├── app/
│   ├── page.tsx                    # Landing page
│   ├── create/
│   │   └── page.tsx                # Main creation interface
│   ├── generate/
│   │   └── [taskId]/
│   │       └── page.tsx            # Generation progress + result
│   ├── api/
│   │   ├── generate/
│   │   │   └── route.ts            # POST - create generation task
│   │   ├── status/
│   │   │   └── [taskId]/
│   │   │       └── route.ts        # GET - poll task status
│   │   └── upload/
│   │       └── route.ts            # POST - handle file uploads
│   ├── layout.tsx
│   └── globals.css
├── components/
│   ├── ui/                         # Shadcn components
│   ├── VideoDropzone.tsx           # File upload component
│   ├── URLInput.tsx                # URL paste component
│   ├── PromptInput.tsx             # Text + image prompt component
│   ├── GenerationProgress.tsx      # Progress indicator
│   ├── VideoPlayer.tsx             # Result video player
│   └── SettingsPanel.tsx           # Duration/resolution settings
├── lib/
│   ├── wan-api.ts                  # Wan API client
│   ├── prompt-expander.ts          # Prompt engineering logic
│   ├── video-utils.ts              # Video URL extraction, validation
│   └── utils.ts                    # General utilities
├── types/
│   └── index.ts                    # TypeScript types
├── .env.local                      # API keys (gitignored)
├── package.json
├── tailwind.config.ts
└── tsconfig.json
```

---

## API Route Specifications

### POST /api/generate

**Request:**
```typescript
{
  referenceVideoUrl?: string;       // URL to reference video
  referenceVideoBase64?: string;    // Base64 encoded video
  referenceImageUrls?: string[];    // URLs to reference images
  referenceImageBase64?: string[];  // Base64 encoded images
  prompt?: string;                  // User's steering prompt
  duration?: 5 | 10 | 15;          // Video duration in seconds
  resolution?: "720P" | "1080P";    // Output resolution
}
```

**Response:**
```typescript
{
  taskId: string;
  status: "PENDING" | "RUNNING" | "SUCCEEDED" | "FAILED";
  estimatedTime?: number;  // seconds
}
```

### GET /api/status/[taskId]

**Response:**
```typescript
{
  taskId: string;
  status: "PENDING" | "RUNNING" | "SUCCEEDED" | "FAILED";
  videoUrl?: string;       // Only when SUCCEEDED
  error?: string;          // Only when FAILED
  progress?: number;       // 0-100 estimate
}
```

---

## Video URL Handling Strategy

### The Challenge
- TikTok, YouTube, Instagram don't provide easy programmatic video download
- OAuth integration is complex and may not grant download rights

### MVP Solution
1. **Accept direct video URLs** (from users who have the actual .mp4 link)
2. **File upload as primary method** - users download videos themselves and upload
3. **Future enhancement**: Integrate a video download service or browser extension

### Alternative Consideration
For the hackathon demo, we could:
- Pre-download a few sample reference videos
- Let users choose from samples OR upload their own
- This simplifies the demo while showing the core value

---

## Prompt Expansion Strategy

### User Input → Expanded Prompt

**User says:** "Edit this video to be focused on my sneakers with a retro vibe"

**System expands to:**
```
A cinematic product showcase video featuring [sneakers] as the central subject. 
Shot with warm, desaturated colors reminiscent of 1970s film stock. 
Subtle film grain overlay, slightly faded blacks, and golden hour lighting.
The camera slowly orbits around the product, highlighting details and textures.
Smooth, deliberate movement. Vintage aesthetic with modern composition.
Background music: lo-fi beats with vinyl crackle undertones.
```

### Implementation
- Use built-in `prompt_extend: true` from Wan API as baseline
- Optionally pre-process with Qwen/other LLM for more control
- Include detected elements from reference video in expanded prompt

---

## Environment Variables

```env
# .env.local
DASHSCOPE_API_KEY=sk-xxxxx
DASHSCOPE_REGION=us  # or 'intl' for Singapore, 'cn' for Beijing
```

---

## MVP Scope Summary

### In Scope (Must Have)
- [ ] Upload video file as reference
- [ ] Upload image(s) as reference  
- [ ] Text steering prompt input
- [ ] Attach images to steering prompt
- [ ] Model routing (t2v, i2v, r2v based on inputs)
- [ ] Async generation with progress UI
- [ ] Video playback and download
- [ ] 720P output, 10-15 second videos

### Out of Scope (Nice to Have / Post-MVP)
- [ ] URL paste for TikTok/YouTube/Instagram (complex)
- [ ] In-browser screen recording
- [ ] User accounts / authentication
- [ ] Generation history persistence
- [ ] Neo4j style graph
- [ ] 1080P option (cost consideration)
- [ ] Multi-turn iteration ("make it more vibrant")

---

## Risk Mitigation

| Risk | Mitigation |
|------|------------|
| Wan API slow/down | Show clear progress, generous timeouts, error recovery |
| Video file too large | Client-side compression or size limits (50MB) |
| Bad prompt = bad output | Strong prompt expansion, show preview of expanded prompt |
| Content moderation rejection | Warn users, show clear error messages |

---

## Demo Script (for Hackathon Presentation)

1. **Open app** - Clean landing page
2. **Upload a sample product video** (pre-prepared sneaker video)
3. **Type prompt**: "Make this into a vintage 70s commercial with film grain"
4. **Show generation progress** - Explain what's happening
5. **Reveal result** - Play generated video
6. **Download** - Show it's a real video file
7. **Second demo**: Upload product image → generate video from scratch

---

## Next Steps

1. Initialize Next.js project with Shadcn
2. Set up Wan API client and test basic text-to-video
3. Build input UI components
4. Implement generation flow
5. Add progress UI
6. Test with various inputs
7. Polish and prepare demo
